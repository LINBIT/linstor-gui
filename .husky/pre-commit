# Run style checks
echo "ğŸ” Running style checks..."

# 1. ESLint check
echo "ğŸ“‹ Running ESLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ESLint failed. Please fix the errors above."
  exit 1
fi

# 2. Prettier auto-fix formatting
echo "ğŸ¨ Running Prettier auto-fix..."
staged_files=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|css)$' | tr '\n' ' ')
if [ -n "$staged_files" ]; then
  npx prettier --write $staged_files
  # Re-add the formatted files to staging
  git add $staged_files
  echo "âœ… Prettier formatting applied and files re-staged."
else
  echo "ğŸ“ No staged files found that need Prettier formatting."
fi

# 3. TypeScript type check
echo "ğŸ“ Running TypeScript type check..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript type check failed. Please fix the type errors above."
  exit 1
fi

# 4. Run tests
echo "ğŸ§ª Running tests..."
npm test
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Please fix the failing tests above."
  exit 1
fi

echo "âœ… All checks passed! Ready to commit."
